<!DOCTYPE html>
<html>

<!--

Simple demo page for Plamp, that illustrates REST Api.

Note: the server is CORS enabled, so this page works
without a server. Simply open the file directly in browser
and set the Plamp host before sending commands.

This REST API uses JSON arrays with POST methods

-->

<script>

function post_data(route, data, response_div)
{
    var host = document.getElementById("host_id" ).value
    var xmlhttp = xmlhttp=new XMLHttpRequest();
    xmlhttp.onreadystatechange=function() {
        if (xmlhttp.readyState==4 && xmlhttp.status >= 200 && xmlhttp.status < 300) {
            var div = document.getElementById(response_div)
	    var s = xmlhttp.responseText +'<br>' + div.innerHTML
            div.innerHTML = s
        }
    }
    var url = host + route;
    console.log('posting to '  + url)
    xmlhttp.open("POST", url, true)
    xmlhttp.setRequestHeader("Content-Type","application/json")
    var s = JSON.stringify(data)
    xmlhttp.send(s)
  
}

function send_color_wipe()
{   
    var data  = JSON.parse(document.getElementById("colorwipe_id" ).value);
    console.log('color wipe ' + data);
    post_data("/color_wipe", data, "responseDiv");
    console.log('done')
}

function send_color_array()
{
    var s = document.getElementById("array_values_id").value
    var data = JSON.parse(s)
    console.log('send_color_array')
    post_data("/color_array", data, "responseDiv");
    console.log('done')
}


</script>

<body>

<h1>PLAMP</h1>
<i>Plamps are good!</i>

<div>
<h2>Plamp host (CORS)</h2>
Plamp is CORS enabled<br>
<input type="text" size="40" value="" id="host_id" /><br>
</div>

<div>
<h2>[POST] /color_wipe</h2>
An array with a color (0-255) and a wait (ms) [r, g, b, w]<br>
<input type="text" size="40" value="[8, 8, 8, 20]" id="colorwipe_id" /><br>
<button onclick="send_color_wipe()" >Send command</button>
</div>

<div>
<h2>[POST] /color_array</h2> 
An array of indexed colors [[i, r, g, b]]<br>
<textarea rows="10" cols="40"  id="array_values_id" >
[
 [ 0, 255,     0,     0],
 [ 7,     0, 255,     0],
 [56,    0,     0, 255],
 [63, 255, 255, 255] 
]
</textarea><br>
<button onclick="send_color_array()">Send command</button>
</div>


<div>
<h2>Response</h2>
Last response first
<div id="responseDiv"/>
</div>


</body>
</html>
